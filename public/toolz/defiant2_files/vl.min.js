!function(){!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a){if(a)return e(a)}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}"undefined"!=typeof b&&(b.exports=d),d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+a]=this._callbacks["$"+a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){this.off(a,c),b.apply(this,arguments)}return c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var d=0,e=c.length;d<e;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],2:[function(a,b,c){function d(){}function e(a){if(!r(a))return a;var b=[];for(var c in a)f(b,c,a[c]);return b.join("&")}function f(a,b,c){if(null!=c)if(Array.isArray(c))c.forEach(function(c){f(a,b,c)});else if(r(c))for(var d in c)f(a,b+"["+d+"]",c[d]);else a.push(encodeURIComponent(b)+"="+encodeURIComponent(c));else null===c&&a.push(encodeURIComponent(b))}function g(a){for(var b,c,d={},e=a.split("&"),f=0,g=e.length;f<g;++f)b=e[f],c=b.indexOf("="),c==-1?d[decodeURIComponent(b)]="":d[decodeURIComponent(b.slice(0,c))]=decodeURIComponent(b.slice(c+1));return d}function h(a){var b,c,d,e,f=a.split(/\r?\n/),g={};f.pop();for(var h=0,i=f.length;h<i;++h)c=f[h],b=c.indexOf(":"),d=c.slice(0,b).toLowerCase(),e=t(c.slice(b+1)),g[d]=e;return g}function i(a){return/[\/+]json\b/.test(a)}function j(a){return a.split(/ *; */).shift()}function k(a){return a.split(/ *; */).reduce(function(a,b){var c=b.split(/ *= */),d=c.shift(),e=c.shift();return d&&e&&(a[d]=e),a},{})}function l(a,b){b=b||{},this.req=a,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this._setStatusProperties(this.xhr.status),this.header=this.headers=h(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this._parseBody(this.text?this.text:this.xhr.response):null}function m(a,b){var c=this;this._query=this._query||[],this.method=a,this.url=b,this.header={},this._header={},this.on("end",function(){var a=null,b=null;try{b=new l(c)}catch(d){return a=new Error("Parser is unable to parse the response"),a.parse=!0,a.original=d,a.rawResponse=c.xhr&&c.xhr.responseText?c.xhr.responseText:null,a.statusCode=c.xhr&&c.xhr.status?c.xhr.status:null,c.callback(a)}c.emit("response",b);var e;try{(b.status<200||b.status>=300)&&(e=new Error(b.statusText||"Unsuccessful HTTP response"),e.original=a,e.response=b,e.status=b.status)}catch(d){e=d}e?c.callback(e,b):c.callback(null,b)})}function n(a,b){var c=s("DELETE",a);return b&&c.end(b),c}var o;o="undefined"!=typeof window?window:"undefined"!=typeof self?self:this;var p=a("emitter"),q=a("./request-base"),r=a("./is-object"),s=b.exports=a("./request").bind(null,m);s.getXHR=function(){if(!(!o.XMLHttpRequest||o.location&&"file:"==o.location.protocol&&o.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}throw Error("Browser-only verison of superagent could not find XHR")};var t="".trim?function(a){return a.trim()}:function(a){return a.replace(/(^\s*|\s*$)/g,"")};s.serializeObject=e,s.parseString=g,s.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},s.serialize={"application/x-www-form-urlencoded":e,"application/json":JSON.stringify},s.parse={"application/x-www-form-urlencoded":g,"application/json":JSON.parse},l.prototype.get=function(a){return this.header[a.toLowerCase()]},l.prototype._setHeaderProperties=function(a){var b=this.header["content-type"]||"";this.type=j(b);var c=k(b);for(var d in c)this[d]=c[d]},l.prototype._parseBody=function(a){var b=s.parse[this.type];return!b&&i(this.type)&&(b=s.parse["application/json"]),b&&a&&(a.length||a instanceof Object)?b(a):null},l.prototype._setStatusProperties=function(a){1223===a&&(a=204);var b=a/100|0;this.status=this.statusCode=a,this.statusType=b,this.info=1==b,this.ok=2==b,this.clientError=4==b,this.serverError=5==b,this.error=(4==b||5==b)&&this.toError(),this.accepted=202==a,this.noContent=204==a,this.badRequest=400==a,this.unauthorized=401==a,this.notAcceptable=406==a,this.notFound=404==a,this.forbidden=403==a},l.prototype.toError=function(){var a=this.req,b=a.method,c=a.url,d="cannot "+b+" "+c+" ("+this.status+")",e=new Error(d);return e.status=this.status,e.method=b,e.url=c,e},s.Response=l,p(m.prototype);for(var u in q)m.prototype[u]=q[u];m.prototype.type=function(a){return this.set("Content-Type",s.types[a]||a),this},m.prototype.responseType=function(a){return this._responseType=a,this},m.prototype.accept=function(a){return this.set("Accept",s.types[a]||a),this},m.prototype.auth=function(a,b,c){switch(c||(c={type:"basic"}),c.type){case"basic":var d=btoa(a+":"+b);this.set("Authorization","Basic "+d);break;case"auto":this.username=a,this.password=b}return this},m.prototype.query=function(a){return"string"!=typeof a&&(a=e(a)),a&&this._query.push(a),this},m.prototype.attach=function(a,b,c){return this._getFormData().append(a,b,c||b.name),this},m.prototype._getFormData=function(){return this._formData||(this._formData=new o.FormData),this._formData},m.prototype.callback=function(a,b){var c=this._callback;this.clearTimeout(),c(a,b)},m.prototype.crossDomainError=function(){var a=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");a.crossDomain=!0,a.status=this.status,a.method=this.method,a.url=this.url,this.callback(a)},m.prototype._timeoutError=function(){var a=this._timeout,b=new Error("timeout of "+a+"ms exceeded");b.timeout=a,this.callback(b)},m.prototype._appendQueryString=function(){var a=this._query.join("&");a&&(this.url+=~this.url.indexOf("?")?"&"+a:"?"+a)},m.prototype.end=function(a){var b=this,c=this.xhr=s.getXHR(),e=this._timeout,f=this._formData||this._data;this._callback=a||d,c.onreadystatechange=function(){if(4==c.readyState){var a;try{a=c.status}catch(d){a=0}if(0==a){if(b.timedout)return b._timeoutError();if(b._aborted)return;return b.crossDomainError()}b.emit("end")}};var g=function(a,c){c.total>0&&(c.percent=c.loaded/c.total*100),c.direction=a,b.emit("progress",c)};if(this.hasListeners("progress"))try{c.onprogress=g.bind(null,"download"),c.upload&&(c.upload.onprogress=g.bind(null,"upload"))}catch(h){}if(e&&!this._timer&&(this._timer=setTimeout(function(){b.timedout=!0,b.abort()},e)),this._appendQueryString(),this.username&&this.password?c.open(this.method,this.url,!0,this.username,this.password):c.open(this.method,this.url,!0),this._withCredentials&&(c.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof f&&!this._isHost(f)){var j=this._header["content-type"],k=this._serializer||s.serialize[j?j.split(";")[0]:""];!k&&i(j)&&(k=s.serialize["application/json"]),k&&(f=k(f))}for(var l in this.header)null!=this.header[l]&&c.setRequestHeader(l,this.header[l]);return this._responseType&&(c.responseType=this._responseType),this.emit("request",this),c.send("undefined"!=typeof f?f:null),this},s.Request=m,s.get=function(a,b,c){var d=s("GET",a);return"function"==typeof b&&(c=b,b=null),b&&d.query(b),c&&d.end(c),d},s.head=function(a,b,c){var d=s("HEAD",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},s.options=function(a,b,c){var d=s("OPTIONS",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},s.del=n,s["delete"]=n,s.patch=function(a,b,c){var d=s("PATCH",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},s.post=function(a,b,c){var d=s("POST",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},s.put=function(a,b,c){var d=s("PUT",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d}},{"./is-object":3,"./request":5,"./request-base":4,emitter:1}],3:[function(a,b,c){function d(a){return null!==a&&"object"==typeof a}b.exports=d},{}],4:[function(a,b,c){var d=a("./is-object");c.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},c.parse=function(a){return this._parser=a,this},c.serialize=function(a){return this._serializer=a,this},c.timeout=function(a){return this._timeout=a,this},c.then=function(a,b){if(!this._fullfilledPromise){var c=this;this._fullfilledPromise=new Promise(function(a,b){c.end(function(c,d){c?b(c):a(d)})})}return this._fullfilledPromise.then(a,b)},c["catch"]=function(a){return this.then(void 0,a)},c.use=function(a){return a(this),this},c.get=function(a){return this._header[a.toLowerCase()]},c.getHeader=c.get,c.set=function(a,b){if(d(a)){for(var c in a)this.set(c,a[c]);return this}return this._header[a.toLowerCase()]=b,this.header[a]=b,this},c.unset=function(a){return delete this._header[a.toLowerCase()],delete this.header[a],this},c.field=function(a,b){if(null===a||void 0===a)throw new Error(".field(name, val) name can not be empty");if(d(a)){for(var c in a)this.field(c,a[c]);return this}if(null===b||void 0===b)throw new Error(".field(name, val) val can not be empty");return this._getFormData().append(a,b),this},c.abort=function(){return this._aborted?this:(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort"),this)},c.withCredentials=function(){return this._withCredentials=!0,this},c.redirects=function(a){return this._maxRedirects=a,this},c.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},c._isHost=function(a){var b={}.toString.call(a);switch(b){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}},c.send=function(a){var b=d(a),c=this._header["content-type"];if(b&&d(this._data))for(var e in a)this._data[e]=a[e];else"string"==typeof a?(c||this.type("form"),c=this._header["content-type"],"application/x-www-form-urlencoded"==c?this._data=this._data?this._data+"&"+a:a:this._data=(this._data||"")+a):this._data=a;return!b||this._isHost(a)?this:(c||this.type("json"),this)}},{"./is-object":3}],5:[function(a,b,c){function d(a,b,c){return"function"==typeof c?new a("GET",b).end(c):2==arguments.length?new a("GET",b):new a(b,c)}b.exports=d},{}],6:[function(a,b,c){"use strict";Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(a){if(null==this)throw new TypeError("'this' is null or not defined");var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var d=arguments[1],e=0;e<c;){var f=b[e];if(a.call(d,f,e,b))return f;e++}}})},{}],7:[function(a,b,c){"use strict";b.exports=function(a){function b(){try{return Boolean(window.sessionStorage.getItem("vl_bubble_notif"))}catch(a){return!1}}function c(){try{window.sessionStorage.setItem("vl_bubble_notif",!0)}catch(a){}}(location.href.indexOf("trendwatching")>-1||location.href.indexOf("athenscannabisexpo")>-1)&&a.addHook("boot",function(){a.config.previewMode||setTimeout(function(){a.get("ping",function(a,b){})},3e3)}),a.addHook("widgetLoad",function(b){function c(b){if(window.matchMedia("(max-width: 455px)").matches){var c,d=navigator.userAgent,e=d.indexOf("iPhone")!==-1||d.indexOf("iPod")!==-1;c=e?window.innerHeight-50:window.innerHeight,"rewardingWidget"===b?a.widgets.getByType("rewardingWidget").forEach(function(b){b.config.embed||(b.frame.style.width="100%",b.frame.style.height=c+"px",b.frame.style.left="0",b.frame.style.top="0",b.config.isMobile=!0,b.send("update_state",{isMobile:!0,hasReferrer:Boolean(a.referrer&&a.referrer.referralCode),origin:a.origin}),b.isMobile=!0)}):"ambassadorWidget"===b?a.widgets.getByType("ambassadorWidget").forEach(function(b){b.frame.style.width="100%",b.frame.style.left="0",b.frame.style.bottom="0",b.frame.style.borderRadius="0px",b.config.isMobile=!0,b.send("update_state",{isMobile:!0,hasReferrer:Boolean(a.referrer&&a.referrer.referralCode),origin:a.origin})}):"embedForm"===b?a.widgets.getByType("embedForm").forEach(function(b){b.config.isMobile=!0,b.send("update_state",{isMobile:!0,hasReferrer:Boolean(a.referrer&&a.referrer.referralCode),origin:a.origin})}):"inviteeForm"===b&&a.widgets.getByType("inviteeForm").forEach(function(b){b.config.isMobile=!0,b.send("update_state",{isMobile:!0,hasReferrer:Boolean(a.referrer&&a.referrer.referralCode),origin:a.origin})})}else"rewardingWidget"===b?a.widgets.getByType("rewardingWidget").forEach(function(b){if(!b.config.embed){if(b.frame.style.width="420px",b.frame.style.height="520px",b.frame.style.left="",b.frame.style.top="",b.config.isMobile=!1,b.config.position)switch(b.config.position){case"bottom-right":b.frame.style.bottom="90px",b.frame.style.right="20px";break;case"bottom-left":b.frame.style.bottom="90px",b.frame.style.left="20px";break;case"top-right":b.frame.style.top="90px",b.frame.style.right="20px";break;case"top-left":b.frame.style.top="90px",b.frame.style.left="20px";break;default:b.frame.style.cssText+=b.config.position}else b.frame.style.bottom="90px",b.frame.style.right="20px";b.send("update_state",{isMobile:!1,hasReferrer:Boolean(a.referrer&&a.referrer.referralCode),origin:a.origin})}}):"ambassadorWidget"===b&&a.widgets.getByType("ambassadorWidget").forEach(function(b){if(b.frame.style.width="341px",b.frame.style.borderRadius=a.widgetData.widgets&&a.widgetData.widgets.ambassadorWidget&&a.widgetData.widgets.ambassadorWidget.roundedCorners?"8px":"0px",a.widgetData.campaignInfo&&a.widgetData.campaignInfo.position||b.config.position)switch(a.widgetData.campaignInfo&&a.widgetData.campaignInfo.position||b.config.position){case"bottom-right":b.frame.style.left="",b.frame.style.bottom="20px",b.frame.style.right="20px";break;case"bottom-left":b.frame.style.right="",b.frame.style.bottom="20px",b.frame.style.left="20px";break;default:b.frame.style.cssText+=b.config.position}else b.frame.style.bottom="20px",b.frame.style.left="20px";b.frame.style.visibility="visible",b.config.isMobile=!1,b.send("update_state",{isMobile:!1,hasReferrer:Boolean(a.referrer&&a.referrer.referralCode),origin:a.origin})})}if(("rewardingWidget"===a.widgets.getById(b.widgetId).type||"ambassadorWidget"===a.widgets.getById(b.widgetId).type)&&!a.config.previewMode){var d=a.widgets.getByType("rewardingWidget").length>0,e=a.widgets.getByType("ambassadorWidget").length>0,f=a.widgets.getByType("embedForm").length>0,g=a.widgets.getByType("inviteeForm").length>0;if(a.widgets.getByType("rewardingWidget").length>0||a.widgets.getByType("ambassadorWidget").length>0){var h=window.matchMedia("(max-width: 455px)").matches;d&&c("rewardingWidget"),e&&c("ambassadorWidget"),f&&c("embedForm"),g&&c("inviteeForm"),window.addEventListener("resize",function(){var a=window.matchMedia("(max-width: 455px)").matches;h!==a&&(h=a,d&&c("rewardingWidget"),e&&c("ambassadorWidget"),f&&c("embedForm"),g&&c("inviteeForm"))},!0)}}}),a.addHook("widgetLoad",function(b){function c(){var b=a.widgetData.widgets.milestoneWidget.milestones.length;a.widgets.getByType("milestoneWidget").forEach(function(c){switch(b){case 3:window.matchMedia("(max-width: 390px)").matches||c.container.element.offsetWidth<=390?c.send("update_state",{isMobile:!0,origin:a.origin}):c.send("update_state",{isMobile:!1,origin:a.origin});break;case 4:window.matchMedia("(max-width: 490px)").matches||c.container.element.offsetWidth<=490?c.send("update_state",{isMobile:!0,origin:a.origin}):c.send("update_state",{isMobile:!1,origin:a.origin});break;case 5:window.matchMedia("(max-width: 590px)").matches||c.container.element.offsetWidth<=590?c.send("update_state",{isMobile:!0,origin:a.origin}):c.send("update_state",{isMobile:!1,origin:a.origin});break;case 6:window.matchMedia("(max-width: 690px)").matches||c.container.element.offsetWidth<=690?c.send("update_state",{isMobile:!0,origin:a.origin}):c.send("update_state",{isMobile:!1,origin:a.origin});break;case 7:window.matchMedia("(max-width: 790px)").matches||c.container.element.offsetWidth<=790?c.send("update_state",{isMobile:!0,origin:a.origin}):c.send("update_state",{isMobile:!1,origin:a.origin});break;case 8:window.matchMedia("(max-width: 890px)").matches||c.container.element.offsetWidth<=890?c.send("update_state",{isMobile:!0,origin:a.origin}):c.send("update_state",{isMobile:!1,origin:a.origin});break;default:c.send("update_state",{isMobile:!1,origin:a.origin})}})}"milestoneWidget"===a.widgets.getById(b.widgetId).type&&(a.config.previewMode||(a.widgets.getByType("milestoneWidget").length>0&&(c(),window.addEventListener("resize",function(){c()},!0)),a.addHook("stageChange",function(){c()})))}),a.addHook("widgetLoad",function(b){function c(b){a.widgets.getByType(b).forEach(function(b){b.send("update_state",{isMobile:window.matchMedia("(max-width: 455px)").matches,origin:a.origin})})}a.widgets.getByType("embedForm").length>0&&(c("embedForm"),window.addEventListener("resize",function(){c("embedForm")},!0)),a.widgets.getByType("inviteeForm").length>0&&(c("inviteeForm"),window.addEventListener("resize",function(){c("inviteeForm")},!0))}),a.addHook("widgetsLoad",function(){document.getElementById("intercom-container")&&(document.getElementById("intercom-container").style.zIndex-=1)});var d=!1;a.addHook("stageChange",function(b){if("postIdentify"===b.stage){if(d)return;d=!0,a.get("campaignInfo",function(b,c){if(!b){var d=c.campaignInfo.integrations;if(d&&(!d||0!==Object.keys(d).length)){if("network"===a.identifiedFrom&&a.user.isNew||a.user.justConfirmed){var e={"First name":a.user.firstname||"","Last name":a.user.lastname||"",Email:a.user.email||""};if(d.segment&&d.segment.enabled&&window.analytics&&window.analytics.track&&"function"==typeof window.analytics.track&&(a.pendingIntegrations.segment=!0,window.analytics.track(d.segment.eventName,e,{},function(){a.pendingIntegrations.segment=!1})),d.googleAnalytics&&d.googleAnalytics.enabled&&window.ga&&"function"==typeof window.ga.getAll&&window.ga.getAll()&&window.ga.getAll().length>0&&(a.pendingIntegrations.googleAnalytics=!0,window.ga(window.ga.getAll()[0].get("name")+".send",{hitType:"event",eventCategory:d.googleAnalytics.category,eventAction:d.googleAnalytics.action,eventLabel:d.googleAnalytics.label,hitCallback:function(){a.pendingIntegrations.googleAnalytics=!1}})),d.facebookPixel&&d.facebookPixel.enabled&&(a.pendingIntegrations.facebookPixel=!0,window.fbq&&"function"==typeof window.fbq&&(window.fbq("trackCustom",d.facebookPixel.eventName),setTimeout(function(){a.pendingIntegrations.facebookPixel=!1},200))),d.mixpanel&&d.mixpanel.enabled&&window.mixpanel&&window.mixpanel.track&&"function"==typeof window.mixpanel.track&&(a.pendingIntegrations.mixPanel=!0,window.mixpanel.track(d.mixpanel.eventName,e,function(){a.pendingIntegrations.mixPanel=!1})),d.customJS&&d.customJS.enabled){var f={"First name":a.user.firstname||"","Last name":a.user.lastname||"",Email:a.user.email||""};try{var g=new Function("isNewParticipant","participantData",d.customJS.code);a.pendingIntegrations.customJS=!0,g("network"===a.identifiedFrom&&a.user.isNew||!1,JSON.parse(JSON.stringify(f))),a.pendingIntegrations.customJs=!1}catch(b){a.pendingIntegrations.customJs=!1}}}a.pendingIntegrations.postIdentify=!1}}})}});var e=!1;a.addHook("widgetsLoad",function(){function b(a,b){var c=b?b:window.location.href,d=new RegExp("[?&]"+a+"=([^&#]*)","i"),e=d.exec(c);return e?decodeURIComponent(e[1]):null}if(!a.config.previewMode&&a.widgetData.widgets&&(!a.widgetData.widgets||a.widgetData.widgets.rewardingWidget)){var c=a.widgets.getByType("rewardingWidget"),d=window.location.href;if(b("autoTrigger")&&!e)return void c.forEach(function(a){a.get("visible")||a.toggle(),e=!0});if(b("referralCode")&&!e&&a.widgetData.campaignInfo.inviteeRewardAvailable===!0)return void c.forEach(function(a){a.get("visible")||(a.toggle(),a.execute(function(a){document.getElementById(a).click()},["info"])),e=!0});if(Array.isArray(a.widgetData.coupons)&&a.widgetData.coupons.filter(function(a){return!a.redeemed}).length>0&&a.widgetData.campaignInfo.pages&&a.widgetData.campaignInfo.pages.checkout&&a.widgetData.campaignInfo.pages.checkout.enabled&&a.widgetData.campaignInfo.pages.checkout.url===d&&!e)return void c.forEach(function(a){a.get("visible")||(a.toggle(),a.execute(function(a){document.getElementById(a).click()},["coupons"])),e=!0});if(Array.isArray(a.widgetData.coupons)&&a.widgetData.coupons.filter(function(a){return!a.redeemed}).length>0&&"network"===a.identifiedFrom&&!e)return void c.forEach(function(a){a.get("visible")||(a.toggle(),a.execute(function(a){document.getElementById(a).click()},["coupons"])),e=!0});if("network"===a.identifiedFrom&&!e)return void c.forEach(function(a){a.get("visible")||(a.toggle(),a.execute(function(a){document.getElementById(a).click()},["sharing"])),e=!0});var f=(Date.now()-a.getSessionInfo().lastSessionEndedAt/36e5)%24;return Array.isArray(a.widgetData.coupons)&&a.widgetData.coupons.filter(function(a){return!a.redeemed}).length>0&&a.getSessionInfo().lastSessionEndedAt>0&&f>=24&&!e?void c.forEach(function(a){a.get("visible")||(a.toggle(),a.execute(function(a){document.getElementById(a).click()},["coupons"])),e=!0}):void 0}}),a.addHook("_frame_available",function(b){if(!a.config.previewMode){var c=a.widgets.getById(b.widgetId).type,d=a.widgets.getById(b.widgetId);if(a.widgetData&&a.widgetData.widgets&&a.widgetData.widgets[c]&&a.widgetData.widgets[c].customCSS&&a.widgetData.widgets[c].customCSS.enabled)d.applyStyle(a.widgetData.widgets[c].customCSS.url);else var e=setInterval(function(){a.widgetData&&a.widgetData.widgets&&a.widgetData.widgets[c]&&a.widgetData.widgets[c].customCSS&&a.widgetData.widgets[c].customCSS.enabled&&(d.applyStyle(a.widgetData.widgets[c].customCSS.url),clearInterval(e))},50)}});var f=!1;a.addHook("stageChange",function(d){"preIdentify"!==d.stage&&a.addHook("widgetUpdate",function(){function d(b){var c=setInterval(function(){a.widgets.getByType("rewardingWidgetTrigger").length>a.widgets.getByType("notificationBubble").length&&b&&b.frame&&parseInt(b.frame.style.height.replace("px",""))>0&&parseInt(b.frame.style.width.replace("px",""))>0&&(h(b),clearInterval(c))},100)}function e(a,b){var c=b.frame.style;switch(a.config.position){case"bottom-right":c.bottom=20+parseInt(a.frame.style.height.replace("px",""))-19+"px",c.right="13px";break;case"bottom-left":c.bottom=20+parseInt(a.frame.style.height.replace("px",""))-19+"px",c.left=20+parseInt(a.frame.style.width.replace("px",""))-19+"px";break;case"top-right":c.top="13px",c.right="13px";break;case"top-left":c.top="13px",c.left=20+parseInt(a.frame.style.width.replace("px",""))-19+"px";break;case null:c.bottom=20+parseInt(a.frame.style.height.replace("px",""))-19+"px",c.right="13px";break;default:var d=g(".trigger-position {"+a.config.position+"}")[0].style;d.bottom?d.right?(c.bottom=parseInt(d.bottom.replace("px",""))+parseInt(a.frame.style.height.replace("px",""))-19+"px",c.right=d.right):d.left&&(c.bottom=parseInt(d.bottom.replace("px",""))+parseInt(a.frame.style.height.replace("px",""))-19+"px",c.left=parseInt(d.left.replace("px",""))+parseInt(a.frame.style.width.replace("px",""))-19+"px"):d.top&&(d.right?(c.top=parseInt(d.top.replace("px",""))-7+"px",c.right=parseInt(d.right.replace("px",""))-7+"px"):d.left&&(c.top=parseInt(d.top.replace("px",""))-7+"px",c.left=parseInt(d.left.replace("px",""))+parseInt(a.frame.style.width.replace("px",""))-19+"px"))}}function g(a){var b=document.implementation.createHTMLDocument(""),c=document.createElement("style");return c.textContent=a,b.body.appendChild(c),c.sheet.cssRules}function h(b){a.widgets.create("notificationBubble",{container:"body"},function(c){e(b,c),a.addHook("_widget_height_change",function(a){a.widgetId===b.widgetId&&e(b,c)}),a.addHook("_widget_width_change",function(a){a.widgetId===b.widgetId&&e(b,c)}),c.show();var d=new Audio(a.origin+"static/notif-sound.mp3");setTimeout(function(){d.play()},300)})}if(!f&&!b()){var i=a.widgets.getByType("rewardingWidgetTrigger");!i||i&&0===i.length||a.widgetData.coupons&&0!==a.widgetData.coupons.filter(function(a){return!a.redeemed}).length&&(i.forEach(function(a){a&&a.frame&&parseInt(a.frame.style.height.replace("px",""))>0&&parseInt(a.frame.style.width.replace("px",""))>0?h(a):d(a)}),f=!0,c())}})})}},{}],8:[function(a,b,c){"use strict";function d(a){this.instance=a,this.resetHooks()}b.exports=function(a){d.prototype=e;var b=new d(a);return b.start(),b};var e={start:function(){var a=this;this.queue=[];var b=!1;setInterval(function(){if(!b){var c=a.queue.shift();if(c){var d=a._hooks[c.name].filter(function(a){return a.options.enabled}).length;d>0&&(b=!0),a._hooks[c.name].filter(function(a){return a.options.enabled}).forEach(function(e,f){var g=50*(f+1);setTimeout(function(){e.callback.call(a.instance,c.params,e),e.options.once&&e.disable(),f===d-1&&(b=!1)},g)})}}},50)},addHook:function(a,b){if(this._hooks[a]&&this._hooks[a].length>=0){var c={callback:b,options:{once:!1,enabled:!0,async:!1},once:function(){return this.options.once=!0,this},enable:function(){return this.options.enabled=!0,this},disable:function(){return this.options.enabled=!1,this},async:function(){return this.options.async=!0,this}};return this._hooks[a].push(c),c}},runHook:function(a,b){var c=this;b=b||{},"ready"===a||"boot"===a?this._hooks[a].filter(function(a){return a.options.enabled}).forEach(function(a,d){a.callback.call(c.instance,b,a),a.options.once&&a.disable()}):this.queue.push({name:a,params:b})},registerPendingHooks:function(){var a=this;!this.instance.pendingHooks||this.instance.pendingHooks&&0===this.instance.pendingHooks.length||(this.instance.pendingHooks.forEach(function(b){a.instance.addHook(b.name,b.cb)}),delete this.instance.pendingHooks)},resetHooks:function(){this._hooks={widgetUpdate:[],widgetLoad:[],widgetsLoad:[],stageChange:[],boot:[],widgetStageChange:[],ready:[],formSubmit:[],_frame_available:[],_frame_ready:[],_widget_height_change:[],_widget_width_change:[],_message_pass_reply:[],_pending_events_completed:[]}}}},{}],9:[function(a,b,c){"use strict";var d=a("superagent"),e=function(a){return window.VL_NEWSLETTER_SHARING?"invitee_widget":window.VL_NEWSLETTER_SUBSCRIBER?"subscriber_page":window.VL_IS_BUILDER_PAGE?"viral_loops_pages":window.VL_IS_SHOPIFY_PAGE?"shopify_referral_page":a||"JS"};b.exports={postEvent:function(a,b,c,f){d.post(a.apiUrl+"v2/events").set("Content-Type","application/json").set("X-UCID",a.publicToken).set("X-FP",a.fp).set("X-BC",JSON.stringify(a.bc)).send({params:{event:b,user:{dt:c.dt,firstname:c.firstname,lastname:c.lastname,email:c.email,referralCode:c.referralCode,appUserId:c.appUserId,facebookId:c.facebookId,createdAt:c.createdAt,extraData:c.extraData,timestamp:c.timestamp,signature:c.signature,distinctId:c.distinctId,consents:c.consents},referrer:{referralCode:a.referrer.referralCode,email:a.referrer.email,appUserId:a.referrer.appUserId},refSource:a.referrer.refSource,acquiredFrom:e(c.acquiredFrom)},publicToken:a.publicToken}).end(function(a,b){a?f(a):f(null,b.body)})},getData:function(a,b,c){var e=[];e=b?b:a.pendingAccessors.filter(function(b){return b.runStage===a.runStage||"any"===b.runStage}).map(function(a){return a.name}),a.config.identifier&&a.config.identifier.hasOwnProperty("userData")||e.indexOf("userData")!=-1||e.push("userData"),b||e.find(function(a){return"campaignInfo"===a})||e.push("campaignInfo");var f={};for(var g in a.config.identifier)a.config.identifier.hasOwnProperty(g)&&(f[g]=a.config.identifier[g]);d.get(a.apiUrl+"v2/data").query({publicToken:a.publicToken,params:{user:f,referrer:a.referrer||{},refSource:a.referrer&&a.referrer.refSource||"",accessors:e}}).set("Accept","application/json").set("X-UCID",a.publicToken).set("X-FP",a.fp).set("X-BC",JSON.stringify(a.bc)).end(function(d,f){d?c(d,{}):(b||(a.activeAccessors=e.map(function(b){return a.accessors[b]}),a.pendingAccessors=a.pendingAccessors.filter(function(b){return b.runStage!==a.runStage&&"any"!==b.runStage})),f.body&&f.body.userData&&a.user&&a.user.email&&(f.body.userData.email=a.user.email),c(null,f.body))})},getRank:function(a,b,c){var e={};for(var f in a.config.identifier)a.config.identifier.hasOwnProperty(f)&&(e[f]=a.config.identifier[f]);d.get(a.apiUrl+"v2/rank").query({publicToken:a.publicToken,params:{user:e}}).set("Accept","application/json").set("X-UCID",a.publicToken).set("X-FP",a.fp).set("X-BC",JSON.stringify(a.bc)).end(function(a,b){a?c(a,{}):c(null,b.body)})},cacheReferrer:function(a,b,c){d.post(a.apiUrl+"v2/cache_referrer").send({email:b.email,publicToken:a.publicToken,referrer:b.referrer}).set("Accept","application/json").set("X-UCID",a.publicToken).set("X-FP",a.fp).set("X-BC",JSON.stringify(a.bc)).end(function(a,b){a?c&&"function"==typeof c&&c(a,{}):c&&"function"==typeof c&&c(null,b.body)})},socialAction:function(a,b,c,e){var f={};f.referralCode=a.user.referralCode,f.postType=b,d.post(a.apiUrl+"v1/social_action").send(f).set("Accept","application/json").set("X-UCID",a.publicToken).set("X-FP",a.fp).set("X-BC",JSON.stringify(a.bc)).end(function(a,b){a?e&&"function"==typeof e&&e(a):e&&"function"==typeof e&&e()})},requestConsentEditLink:function(a,b,c,e){var f={};f.referralCode=a.user.referralCode,f.postType=b,f.postData=c,d.post(a.apiUrl+"v2/request_consent_edit_link").send(f).set("Accept","application/json").set("X-UCID",a.publicToken).set("X-FP",a.fp).set("X-BC",JSON.stringify(a.bc)).end(function(a,b){a?e&&"function"==typeof e&&e(a):e&&"function"==typeof e&&e()})},guestCheckoutSilentRefresh:function(a){d.get(location.href).end(function(b,c){b?a(c.body.error):a()})}}},{superagent:2}],10:[function(a,b,c){"use strict";function d(a,b){this.namespace=a+"#",this.noPersist=b.noPersist}b.exports=function(a,b){d.prototype=f;var c=new d(a,b);return c};var e=3e4,f={get:function(a){if(!this.noPersist){var b;b=this.enabled()?localStorage.getItem(this.namespace+a):this.readCookie(this.namespace+a);try{b=JSON.parse(b)}catch(c){b=null}return b}},set:function(a,b){if(!this.noPersist)return this.enabled()?localStorage.setItem(this.namespace+a,JSON.stringify(b)):document.cookie=this.namespace+a+"="+JSON.stringify(b),this},enabled:function(){var a="test";try{var b=window.sessionStorage;return b.setItem(a,"1"),b.removeItem(a),!0}catch(c){return!1}},clear:function(){this.noPersist||(this.enabled()?(localStorage.removeItem(this.namespace+"user"),localStorage.removeItem(this.namespace+"referrer"),localStorage.removeItem(this.namespace+"last_session_end"),localStorage.removeItem(this.namespace+"session_start"),localStorage.removeItem(this.namespace+"distinctId"),localStorage.removeItem(this.namespace+"accessorBox")):(this.deleteCookie(this.namespace,"user"),
this.deleteCookie(this.namespace,"referrer"),this.deleteCookie(this.namespace,"last_session_end"),this.deleteCookie(this.namespace,"session_start"),this.deleteCookie(this.namespace,"distinctId"),this.deleteCookie(this.namespace,"accessorBox")))},clearSingle:function(a){this.noPersist||(this.enabled()?localStorage.removeItem(this.namespace+a):this.deleteCookie(this.namespace,a))},readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null},deleteCookie:function(a,b){document.cookie=a+b+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"},removeGuestCheckoutCookie:function(a){document.cookie="vl_guest_checkout="+a+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},saveGuestCheckoutCookie:function(a){document.cookie="vl_guest_checkout="+a+";Path=/;"},validCacheExists:function(a){var b=this.get("accessorBox");if(b){if(Date.now()-b.ts<e){var c=Object.keys(b.accessors),d=a.every(function(a){return c.indexOf(a)>-1});return!!d&&(this.accessors=b.accessors,!0)}return this.clearSingle("accessorBox"),!1}return!1},getCachedAccessors:function(){return this.accessors?this.accessors:this.validCacheExists()?this.accessors:null},saveAccessorsToCache:function(a){var b=this,c={ts:Date.now()};this.accessors=this.accessors||{},Object.keys(a).forEach(function(c){"coupons"!==c&&(b.accessors[c]=a[c])}),c.accessors=this.accessors,this.set("accessorBox",c)}}},{}],11:[function(a,b,c){"use strict";function d(a){return a.campaignInfo&&a.campaignInfo.gdprJson&&a.campaignInfo.gdprJson&&(a.campaignInfo.gdprJson.consents=a.campaignInfo.gdprJson.consents.filter(function(a){return a.visible===!0}).sort(function(a,b){return a.order>b.order})),a}function e(a,b){var c=this;c.instance=a,c.services=i,c.helpers=j,k.setOrigin(b.origin),c.widgetKeep=k,h=l(c.instance.publicToken,c.instance.config),b&&b.previewMode&&this.exposeAction({action:"updateState",from:c,to:c.instance}),this.exposeAction({action:"getAll",from:k,to:c.instance.widgets}),this.exposeAction({action:"getById",from:k,to:c.instance.widgets}),this.exposeAction({action:"getByType",from:k,to:c.instance.widgets}),this.exposeAction({action:"getByContainer",from:k,to:c.instance.widgets}),this.exposeAction({action:"getWidgetsWithInactiveFrame",from:k,to:c.instance.widgets,alias:"__getWidgetsWithInactiveFrame"})}function f(a){var b=this;k.addAction(a.widgetId,"messagePass",function(c,d,e){arguments.length<2||(2===arguments.length&&(e=d,d={}),this.send("message_pass",{data:{message:c,options:d},origin:b.instance.origin}),b.instance.addHook("_message_pass_reply",function(b){e.call(a,b)}).once())}),k.addAction(a.widgetId,"show",function(a){var c=function(){var c,d=b.helpers.getQueryString("testMode");("true"==d||localStorage.getItem("vl_testMode")||b.instance.config.previewMode)&&(c=!0),b.instance.widgetData&&b.instance.widgetData.campaignInfo&&b.instance.widgetData.campaignInfo.isLive===!0&&(c=!0),b.instance.widgetData&&b.instance.widgetData.campaignInfo&&b.instance.widgetData.campaignInfo.campaignPageUrl&&window.location.href.indexOf(b.instance.widgetData.campaignInfo.campaignPageUrl)>-1&&(c=!1),window.parent&&window.parent.SHOW_VL_WIDGET===!0&&(c=!0),c&&(a&&a.withEmptyState&&!b.instance.config.previewMode?this.send("empty_state",{data:{},previewMode:!0,runStage:b.instance.runStage,hasReferrer:Boolean(b.instance.referrer&&b.instance.referrer.referralCode),origin:b.instance.origin}):this.send("init_frame",{data:b.instance.widgetData,previewMode:b.instance.config.previewMode,runStage:b.instance.runStage,isMobile:window.matchMedia("(max-width: 455px)").matches,hasReferrer:Boolean(b.instance.referrer&&b.instance.referrer.referralCode),origin:b.instance.origin,publicToken:b.instance.publicToken}))}.bind(this);window.parent&&window.parent.SHOW_VL_WIDGET===!1?this.ready&&this.toggle():this.ready?this.send("update_state",{data:b.instance.widgetData,runStage:b.instance.runStage,origin:b.instance.origin}):this.available?c():k.addAction(this.widgetId,"loadWhenReady",function(){c()})}),k.addAction(a.widgetId,"hide",function(){this.frame.style.display="none",this.container.element!==document.body&&(this.container.element.style.display="none"),this.update("visible",!1)}),k.addAction(a.widgetId,"resize",function(a,b){null!==a&&(this.frame.style.width=a),null!==b&&(this.frame.style.height=b)}),k.addAction(a.widgetId,"toggle",function(){var a;a="none"===this.frame.style.display?"visible":"hidden",this.messagePass("preToggle",function(){"none"===this.frame.style.display?(this.config.isMobile&&this.config.canFloat&&this.container.element===document.body&&(this.container.elementOptions=this.container.elementOptions||{},this.container.elementOptions.overflow=document.body.style.overflow,this.container.elementOptions.position=document.body.style.position,this.container.elementOptions.scrollTop=document.body.scrollTop,document.body.style.overflow="hidden",document.body.style.position="fixed"),this.frame.style.display="block",this.container.element!==document.body&&(this.container.element.style.display="block"),this.update("visible",!0)):(this.config.isMobile&&this.config.canFloat&&this.container.element===document.body&&(document.body.style.overflow=this.container.elementOptions.overflow,document.body.style.position=this.container.elementOptions.position,document.body.scrollTop=this.container.elementOptions.scrollTop),this.frame.style.display="none",this.container.element!==document.body&&(this.container.element.style.display="block"),this.update("visible",!1)),this.pairs().forEach(function(c){c.send("pair_state_change",{data:{change:{visibility:a}},runStage:b.instance.runStage,hasReferrer:Boolean(b.instance.referrer&&b.instance.referrer.referralCode),origin:b.instance.origin})}),this.messagePass("postToggle",function(){window.dispatchEvent(new Event("resize"))})})}),k.addAction(a.widgetId,"applyStyle",function(a){a&&this.send("apply_style",{data:{style:a},runStage:b.instance.runStage,origin:b.instance.origin})}),k.addAction(a.widgetId,"execute",function(a,c){c=c||[],a&&"function"==typeof a&&this.send("execute",{data:{fn:a.toString(),args:JSON.parse(JSON.stringify(c))},runStage:b.instance.runStage,origin:b.instance.origin})})}function g(a){var b=0,c=0;a.services.hooks.addHook("_frame_available",function(c){b+=1;var d=a.widgetKeep.getById(c.widgetId);d.update("available",!0),b===a.widgetKeep.widgetCount(),d.hasAction("loadWhenReady")&&d.loadWhenReady()}),a.services.hooks.addHook("_frame_ready",function(b){c+=1;var d=a.widgetKeep.getById(b.widgetId);d.update("ready",!0),a.instance.onWidgetLoad&&"function"==typeof a.instance.onWidgetLoad&&a.instance.onWidgetLoad(d.widgetId),a.services.hooks.runHook("widgetLoad",{widgetId:d.widgetId}),c===a.widgetKeep.widgetCount(a.instance.runStage)&&(c=0,a.instance.onWidgetsLoad&&"function"==typeof a.instance.onWidgetsLoad&&a.instance.onWidgetsLoad(),a.services.hooks.runHook("widgetsLoad"))})}var h,i={},j={scan:a("./widgetManager/scan"),build:a("./widgetManager/build"),addToDom:a("./widgetManager/addToDom"),messageHandler:a("./widgetManager/messageHandler"),getQueryString:a("./widgetManager/getQueryString")},k=a("./widgetManager/widgetKeep")(),l=a("./vlStore");b.exports={init:function(a,b){e.prototype=m;var c=new e(a,b),d=j.messageHandler.bind(c);return c.setupListeners(d),c.createListenerDetacher(d),c.applyFrameStyle(),i.hooks=b.hooks,i.network=b.network,c}};var m={setupListeners:function(a){window.addEventListener?window.addEventListener("message",a,!1):window.attachEvent&&window.attachEvent("message",a)},createListenerDetacher:function(a){this.removeListeners=function(){window.removeEventListener?window.removeEventListener("message",a):window.detachEvent&&window.detachEvent("message",a)}},registerWidgets:function(a){var b=this;return a.forEach(function(a){a.accessors.forEach(function(a){b.instance.pendingAccessors.find(function(b){return b.name===a})||b.instance.pendingAccessors.push(b.instance.accessors[a])}),k.register(a),f.call(b,a)}),k.getAll()},preload:function(){var a,b=this;a=j.scan(b.instance.publicToken);var c;c=j.build(b.instance.publicToken,a,{frameUrl:b.instance.frameUrl});var d=b.registerWidgets(c);g(b),d.forEach(function(a){j.addToDom(a,function(b){a.add("frame",b),i.hooks.runHook("_frame_available",{widgetId:a.get("widgetId")})},function(c){a&&a.get("available")===!1&&b.instance.reportError(b.instance.makeError("widget failed to load"))})})},applyFrameStyle:function(){var a=document.createElement("style");a.type="text/css",a.innerHTML=".vl-frame::-webkit-scrollbar{ display: none } @keyframes vl-bounceIn {0% {transform: scale(0.1);opacity: 0;}60% {transform: scale(1.2);opacity: 1;}100% {transform: scale(1);}}",document.getElementsByTagName("head")[0].appendChild(a)},updateState:function(a,b){var c=this;a&&(!a||a.match(c.instance.publicToken)&&k.getById(a)&&k.getById(a).get("frame"))&&k.getById(a).send("update_state",{data:b,runStage:c.instance.runStage,origin:c.instance.origin})},getData:function(a,b){var c=this;if(c.instance.config&&c.instance.config.previewMode)a();else{var e=c.instance.pendingAccessors.filter(function(a){return a.runStage===c.instance.runStage||"any"===a.runStage&&(!c.instance.widgetData||!c.instance.widgetData[a.name])});e.length>0?!b&&h.validCacheExists(e.map(function(a){return a.name}))?(c.instance.widgetData=c.instance.widgetData||{},Object.keys(h.getCachedAccessors()).forEach(function(a){c.instance.widgetData[a]=h.getCachedAccessors()[a]}),a(null,h.getCachedAccessors())):i.network.getData(c.instance,null,function(b,e){return b?a(b):(c.instance.widgetData=c.instance.widgetData||{},Object.keys(e).forEach(function(a){c.instance.widgetData[a]=e[a]}),e=d(e),h.saveAccessorsToCache(e),void a(null,e))}):a(null,c.instance.widgetData)}},getDataOnDemand:function(a,b){var c=this;h.validCacheExists(a)?b(null,h.getCachedAccessors()):i.network.getData(c.instance,a,function(a,c){return a?b(a):(h.saveAccessorsToCache(c),void b(null,c))})},exposeAction:function(a){a&&a.from&&a.action&&a.from[a.action]&&"function"==typeof a.from[a.action]&&(a.to[a.alias||a.action]=function(){return a.from[a.action].apply(a.from,Array.prototype.slice.call(arguments))})},createDataPoller:function(){var a=this,b=!1;return function(){if(!b&&!a.instance.config.previewMode&&a.instance.widgetData&&a.instance.widgetData.campaignInfo&&"dropboxV3"===a.instance.widgetData.campaignInfo.template){b=!0;var c=0,d=setInterval(function(){var e=a.instance.activeAccessors.filter(function(b){return b.runStage===a.instance.runStage||"any"===b.runStage}).map(function(a){return a.name});setTimeout(function(){a.getDataOnDemand(e,function(c,e){c||(e.coupons&&e.coupons.length!==a.instance.widgetData.coupons.length&&(clearInterval(d),b=!1),a.instance.widgetData=a.instance.widgetData||{},Object.keys(e).forEach(function(b){"referralUrls"!==b&&(a.instance.widgetData[b]=e[b])}),k.getAll().forEach(function(b){b.send("update_state",{data:a.instance.widgetData,runStage:a.instance.runStage,origin:a.instance.origin})}))})},1e3),c>=20&&(clearInterval(d),b=!1),c+=1},1e3)}}}}},{"./vlStore":10,"./widgetManager/addToDom":12,"./widgetManager/build":13,"./widgetManager/getQueryString":14,"./widgetManager/messageHandler":15,"./widgetManager/scan":16,"./widgetManager/widgetKeep":17}],12:[function(a,b,c){"use strict";b.exports=function(a,b,c){var d=document.createElement("iframe");d.id=a.widgetId,d.src=a.path,d.style.cssText=a.styles,d.className+="vl-frame",d.style.display="none",a.config.canFloat&&!a.config.embed?document.body.appendChild(d):a.container.element.appendChild(d),d.onload=function(){b(d)},setTimeout(function(){c(d)},1e4)}},{}],13:[function(a,b,c){"use strict";function d(a,b){switch(b=b||{},a){case"sharingWidget":return["widgets","referralUrls","campaignInfo"];case"rewardStats":return["widgets","stats","referralCount","campaignInfo","coupons"];case"welcomeBar":return["widgets","referrerInfo","rewards","campaignInfo"];case"rewardingWidget":return["widgets","stats","referralCount","referralUrls","logs","userData","coupons","campaignInfo"];case"rewardingWidgetTrigger":return["campaignInfo","widgets"];case"embedForm":return["widgets","referralUrls","campaignInfo","userData","referralCount"];case"inviteeForm":return["widgets","referralUrls","campaignInfo","userData","referralCount"];case"milestoneWidget":return["widgets","referralCount"];case"referralCountWidget":return["widgets","referralCount"];case"notificationBubble":return["coupons"];case"takeOverWidget":return["widgets","stats","referralCount","referralUrls","logs","userData","coupons","campaignInfo"];case"ambassadorWidget":return["widgets","referralUrls","campaignInfo","userData","referralCount"];default:return[]}}function e(a,b){switch(b=b||{},a){case"sharingWidget":return b.frameUrl+"sharingWidget/sharingWidget.min.html";case"rewardStats":return b.frameUrl+"rewardStats/rewardStats.min.html";case"welcomeBar":return b.frameUrl+"welcomeBar/welcomeBar.min.html";case"rewardingWidget":return b.frameUrl+"rewardingWidget/rewardingWidget.min.html";case"rewardingWidgetTrigger":return b.frameUrl+"rewardingWidgetTrigger/rewardingWidgetTrigger.min.html";case"embedForm":return b.frameUrl+"embedForm/embedForm.min.html";case"inviteeForm":return b.frameUrl+"inviteeForm/inviteeForm.min.html";case"milestoneWidget":return b.frameUrl+"milestoneWidget/milestoneWidget.min.html";case"referralCountWidget":return b.frameUrl+"referralCountWidget/referralCountWidget.min.html";case"notificationBubble":return b.frameUrl+"notificationBubble/notificationBubble.min.html";case"takeOverWidget":return b.frameUrl+"takeOverWidget/takeOverWidget.min.html";case"ambassadorWidget":return b.frameUrl+"ambassadorWidget/ambassadorWidget.min.html";default:return""}}function f(a,b){switch(b=b||{},a){case"sharingWidget":return"postIdentify";case"rewardStats":return"postIdentify";case"welcomeBar":return"preIdentify";case"rewardingWidget":return"any";case"rewardingWidgetTrigger":return"any";case"embedForm":return"any";case"inviteeForm":return"any";case"milestoneWidget":return"any";case"referralCountWidget":return"any";case"notificationBubble":return"postIdentify";case"takeOverWidget":return"postIdentify";case"ambassadorWidget":return"any";default:return"any"}}function g(a,b){switch(b=b||{},a){case"sharingWidget":return null;case"rewardStats":return null;case"welcomeBar":return"postIdentify";case"rewardingWidget":return null;case"rewardingWidgetTrigger":return null;case"embedForm":return null;case"inviteeForm":return null;case"milestoneWidget":return null;case"referralCountWidget":return null;case"notificationBubble":return null;case"takeOverWidget":return null;case"ambassadorWidget":return null;default:return null}}function h(a,b){b=b||{};var c="border:none; margin:0; padding:0; overflow:hidden; z-index:2147483647; border-radius:4px;";switch(a){case"sharingWidget":c+="left:0%;width:100%;height:100%;";break;case"rewardStats":c+="left:0%;width:100%;height:100%;";break;case"welcomeBar":c+="left:0%;width:100%;height:100%;";break;case"rewardingWidget":if(b.embed)c+="left:0%;width:100%;height:100%;";else{if(window.matchMedia("(max-width: 455px)").matches){var d=navigator.userAgent,e=d.indexOf("iPhone")!==-1||d.indexOf("iPod")!==-1,f=void 0;f=e?window.innerHeight-50:window.innerHeight,c+="position:fixed;width:100%;height:"+f+"px;",b.position="left:0;top:0",b.isMobile=!0}else c+="position:fixed;width:420px;height:520px;border-radius: 4px;";if(c+="opacity: 0",c+="-webkit-box-shadow: 0 4px 30px rgba(0, 0, 0, .12);box-shadow: 0 4px 30px rgba(0, 0, 0, .12);border-radius:4px;z-index:2147483647;",b.position)switch(b.position){case"bottom-right":c+="bottom:90px;right:20px;";break;case"bottom-left":c+="bottom:90px;left:20px;";break;case"top-right":c+="top:90px;right:20px;";break;case"top-left":c+="top:90px;left:20px;";break;default:c+=b.position}else c+="bottom:90px;right:20px;"}break;case"rewardingWidgetTrigger":if(b.embed)c+="left:0%;width:100%;height:100%;";else if(c+="position:fixed;box-shadow: 0 4px 30px rgba(0, 0, 0, .12); border-radius:50px; z-index:2147483645;",b.position)switch(b.position){case"bottom-right":c+="bottom:20px;right:20px;";break;case"bottom-left":c+="bottom:20px;left:20px;";break;case"top-right":c+="top:20px;right:20px;";break;case"top-left":c+="top:20px;left:20px;";break;default:c+=b.position}else c+="bottom:20px;right:20px;";break;case"embedForm":c+="left:0%;width:100%;height:100%; border-radius:0px;",b.isMobile=window.matchMedia("(max-width: 455px)").matches;break;case"inviteeForm":c+="left:0%;width:100%;height:100%; border-radius:0px;",b.isMobile=window.matchMedia("(max-width: 455px)").matches;break;case"milestoneWidget":c+="left:0%;width:100%;height:100%;";break;case"referralCountWidget":c+="left:0%;width:100%;height:100%;";break;case"notificationBubble":c+="width:22px;height:22px;position:fixed;box-shadow: 0 4px 30px rgba(0, 0, 0, .12); border-radius:50px; z-index:2147483646; animation: vl-bounceIn 0.6s; ";break;case"takeOverWidget":c+="position:fixed;width:100%;height:100%;border-radius: 4px;";break;case"ambassadorWidget":if(b.embed)c+="left:0%;width:100%;height:100%;";else if(c+="opacity: 0",c+=" transition: height 0.1s ease-out 0s;border-radius:5px;box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);z-index:2147483647;",window.matchMedia("(max-width: 455px)").matches)c+="position:fixed;width:100%;min-height:52px;border-radius:0;background: #fff;",c+="bottom:0px;left:0px;",b.isMobile=!0;else if(c+="position:fixed;width:341px;border-radius: 5px;background: #fff;",c+="bottom:20px;left:20px;",b.isMobile=!1,b.position)switch(b.position){case"bottom-right":c+="bottom:20px;right:20px;";break;case"bottom-left":c+="bottom:20px;left:20px;";break;default:c+=b.position}else c+="visibility: hidden;";break;default:return""}return c}function i(a,b){switch(b=b||{},a){case"rewardingWidget":b.canFloat=!0,b.staticHeight=!0,b.pair="rewardingWidgetTrigger";break;case"rewardingWidgetTrigger":b.canFloat=!0,b.pair="rewardingWidget";break;case"notificationBubble":b.canFloat=!0,b.staticHeight=!0,b.pair="rewardingWidgetTrigger";break;case"takeOverWidget":b.canFloat=!0,b.staticHeight=!0;break;case"ambassadorWidget":b.canFloat=!0,b.staticHeight=!1}return b}function j(a,b,c){return c&&c.widgetId?a+"_"+b+"_"+c.widgetId:a+"_"+b+"_"+Math.random().toString(36).substring(7)}b.exports=function(a,b,c){return b.map(function(b){return{type:b.type,available:!1,ready:!1,visible:!1,container:b,widgetId:j(a,b.type,b.options),path:e(b.type,c),accessors:d(b.type,b.options),runStage:f(b.type,b.options),hideStage:g(b.type,b.options),styles:h(b.type,b.options),config:i(b.type,b.options)}})}},{}],14:[function(a,b,c){"use strict";function d(){var a=!1,b={},c=null,d=location.search.substring(1);arguments.length>0&&arguments[0].length>1&&(a=arguments[0]);for(var e=/([^&=]+)=([^&]*)/g;c=e.exec(d);){if(a!==!1&&decodeURIComponent(c[1])===a)return decodeURIComponent(c[2]);a===!1&&(b[decodeURIComponent(c[1])]=decodeURIComponent(c[2]))}return a===!1?b:null}b.exports=d},{}],15:[function(a,b,c){"use strict";function d(){if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)){var a=document.querySelector('meta[name="viewport"]'),b=a.getAttribute("content");a&&(a.setAttribute("content","width=device-width, minimum-scale=1.0, maximum-scale=1.0, initial-scale=1.0"),a.setAttribute("content",b))}}b.exports=function(a){if(!(a&&a.data&&"inpage"==a.data.target||"contentscript"==a.data.target)){var b=this;if(a.data.widgetId&&(!a.data.widgetId||a.data.widgetId.match(b.instance.publicToken)))if("frame_ready"===a.data.type){var c=b.widgetKeep.getById(a.data.widgetId);if(null===c)return;c.config&&c.config.staticHeight||(c.frame.style.height=a.data.data.height+"px"),!a.data.data.keepHidden||c.container.element.dataset&&"true"===c.container.element.dataset.vlWidgetEmbed?setTimeout(function(){b.services.hooks.runHook("_frame_ready",{widgetId:a.data.widgetId}),c.frame.style.display="block",c.update("visible",!0)},300):b.services.hooks.runHook("_frame_ready",{widgetId:a.data.widgetId})}else if("action_dispatch"===a.data.type)switch(a.data.data.action){case"facebook":case"twitter":case"reddit":case"email":case"copy":case"linkedin":case"whatsapp":b.services.network.socialAction(b.instance,a.data.data.action,a.data.data.actionData);break;case"rewardingWidgetTrigger":b.widgetKeep.getById(a.data.widgetId).pairs().forEach(function(a){a.toggle()});break;case"rewardingWidgetTriggerFromInside":b.widgetKeep.getById(a.data.widgetId).toggle();break;case"togglePairWidgets":b.widgetKeep.getById(a.data.widgetId).pairs().forEach(function(a){a.toggle()});break;case"toggleWidget":b.widgetKeep.getById(a.data.widgetId).toggle();break;case"closePairWidgets":b.widgetKeep.getById(a.data.widgetId).pairs().forEach(function(a){a.hide()});break;case"resizeIframe":if(null===b.widgetKeep.getById(a.data.widgetId))return;b.widgetKeep.getById(a.data.widgetId).resize(a.data.data.actionData.width,a.data.data.actionData.height);break;case"identify":console;b.instance.identify(a.data.data.actionData,function(a,b){d()});break;case"widgetStageChange":b.instance.config.previewMode&&b.services.hooks.runHook("widgetStageChange",{widgetId:a.data.widgetId,stage:a.data.data.actionData.stage});break;case"pageChange":b.instance.config.previewMode||(location.href=a.data.data.actionData.url);break;case"requestConsentEditLink":b.services.network.requestConsentEditLink(b.instance,a.data.data.action,a.data.data.actionData)}else"updated"===a.data.type?(b.instance.onWidgetUpdate&&"function"==typeof b.instance.onWidgetUpdate&&b.instance.onWidgetUpdate(a.data.widgetId,a.data.data.diff),b.services.hooks.runHook("widgetUpdate",{widgetId:a.data.widgetId,diff:a.data.data.diff})):"set_height"===a.data.type?b.widgetKeep.getById(a.data.widgetId)&&(b.widgetKeep.getById(a.data.widgetId).frame.style.height=a.data.data.height+"px",b.services.hooks.runHook("_widget_height_change",{widgetId:a.data.widgetId,height:a.data.data.height})):"set_width"===a.data.type?b.widgetKeep.getById(a.data.widgetId)&&(a.data.data.width>0&&(b.widgetKeep.getById(a.data.widgetId).frame.style.width=a.data.data.width+"px"),b.services.hooks.runHook("_widget_width_change",{widgetId:a.data.widgetId,width:a.data.data.width})):"message_pass_reply"===a.data.type?b.services.hooks.runHook("_message_pass_reply",a.data.data):"set_height_full"===a.data.type&&(b.widgetKeep.getById(a.data.widgetId).frame.style.height="100%",b.services.hooks.runHook("_widget_height_change",{widgetId:a.data.widgetId,height:"100%"}))}}},{}],16:[function(a,b,c){"use strict";b.exports=function(a){var b,c=["sharingWidget","rewardStats","welcomeBar","rewardingWidget","rewardingWidgetTrigger","embedForm","inviteeForm","milestoneWidget","referralCountWidget","notificationBubble","takeOverWidget","ambassadorWidget"],d=Array.prototype.slice.call(document.querySelectorAll("[data-vl-widget]")),e=[].filter.call(d,function(b){return b.getAttribute("data-vl-widget-for")===a}),f=[].filter.call(d,function(a){return!a.getAttribute("data-vl-widget-for")});return b=e.length>0?e:f,b=[].filter.call(b,function(a){return a.dataset&&c.indexOf(a.dataset.vlWidget)>-1}),[].map.call(b,function(a){return{type:a.getAttribute("data-vl-widget"),element:a,options:{position:a.getAttribute("data-vl-widget-position")||null,embed:"true"===a.getAttribute("data-vl-widget-embed"),autoTriggerOnReferral:"false"!==a.getAttribute("data-vl-widget-auto-trigger-on-referral"),widgetId:a.getAttribute("data-vl-widget-id")||null}}})}},{}],17:[function(a,b,c){"use strict";function d(){this.keep={}}b.exports=function(){return d.prototype=e,new d};var e={setOrigin:function(a){this.frameOrigin=a},getById:function(a){return this.keep[a]||null},getByType:function(a){var b=this,c=[];return Object.keys(this.keep).forEach(function(d){b.keep[d].type===a&&c.push(b.keep[d])}),c},getByContainer:function(a){var b=this,c=document.querySelector(a);if(c){var d=void 0;return Object.keys(this.keep).forEach(function(a){b.keep[a].container.element===c&&(d=b.keep[a])}),d}return null},getWidgetsWithInactiveFrame:function(){var a=this;return Object.keys(this.keep).filter(function(b){return a.keep[b].frame&&!document.getElementById(a.keep[b].widgetId)}).map(function(b){return a.keep[b]})},widgetCount:function(a){var b=this;return a?Object.keys(this.keep).filter(function(c){return b.keep[c].runStage===a||"any"===b.keep[c].runStage}).length:Object.keys(this.keep).length},widgetAvailableCount:function(){var a=this;return Object.keys(this.keep).filter(function(b){return a.keep[b].available}).length},widgetReadyCount:function(){var a=this;return Object.keys(this.keep).filter(function(b){return a.keep[b].ready}).length},getAll:function(){var a=this;return Object.keys(this.keep).map(function(b){return a.keep[b]})},register:function(a){var b=this;return this.keep[a.widgetId]=a,this.addAction(a.widgetId,"hasAction",function(c){return b.keep[a.widgetId]&&b.keep[a.widgetId][c]&&"function"==typeof b.keep[a.widgetId][c]}),this.addAction(a.widgetId,"update",function(c,d){b.keep[a.widgetId]&&null!==b.keep[a.widgetId][c]&&void 0!==b.keep[a.widgetId][c]&&(b.keep[a.widgetId][c]=d)}),this.addAction(a.widgetId,"add",function(c,d){b.keep[a.widgetId]&&(b.keep[a.widgetId][c]=d)}),this.addAction(a.widgetId,"get",function(c){return b.keep[a.widgetId]&&void 0!==b.keep[a.widgetId][c]?b.keep[a.widgetId][c]:null}),this.addAction(a.widgetId,"send",function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{data:{},previewMode:!1,runStage:"any",origin:this.frameOrigin,isMobile:window.matchMedia("(max-width: 455px)").matches};this.frame&&this.frame.contentWindow&&this.frame.contentWindow.postMessage({type:a,widgetId:this.widgetId,data:b.data||{},previewMode:b.previewMode,error:b.error||null,runStage:b.runStage,hasReferrer:b.hasReferrer||!1,isMobile:b.isMobile,publicToken:b.publicToken||"",frameOrigin:b.origin},b.origin)}),this.addAction(a.widgetId,"pairs",function(){return b.getByType(a.config.pair)}),this.keep[a.widgetId]},remove:function(a){if(this.keep[a]&&(!this.keep[a]||this.keep[a].frame))return this.keep[a].frame.parentNode===document.body?document.body.removeChild(this.keep[a].frame):this.keep[a].container.element.removeChild(this.keep[a].frame),delete this.keep[a],this},removeAll:function(){var a=this;Object.keys(this.keep).forEach(function(b){a.remove(b)})},addAction:function(a,b,c){b&&c&&"function"==typeof c&&(this.keep[a][b]=c.bind(this.keep[a]))}}},{}],18:[function(a,b,c){"use strict";var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};window.VL.setup=function(b){function c(){var a=b;if(!a.publicToken&&!a.config.previewMode)return void b.reportError(b.makeError("publicToken not provided"));D=F(a.publicToken,a.config),G.preload(),a.config.previewMode||window.location.href.indexOf("ambassador.producthunt")!==-1||window.location.href.indexOf("ambassadors.producthunt")!==-1||(b.referrer=m()),b.identify=o(),b.cacheReferrer=p(),D.get("user")?b.afterLoad&&b.afterLoad.identify&&!b.identified&&!a.config.previewMode?b.identify(b.afterLoad.identify.userData,b.afterLoad.identify.cb):b.identify():b.afterLoad&&b.afterLoad.identify&&!b.identified&&!a.config.previewMode?b.identify(b.afterLoad.identify.userData,b.afterLoad.identify.cb):(h("autoDetect")||h("userCode"))&&b.identify({autoDetect:!0}),b.onBoot&&"function"==typeof b.onBoot&&b.onBoot(),C.hooks.runHook("boot"),C.hooks.runHook("ready"),b.$=function(a){a.call(b)},(window.location.href.indexOf("ambassador.producthunt")>-1||window.location.href.indexOf("ambassadors.producthunt")>-1)&&(b.referrer=m()),b.config.autoLoadWidgets&&b.widgets.load();var c=G.helpers.getQueryString("testMode");if(("true"===c||localStorage.getItem("vl_testMode"))&&!b.config.previewMode){localStorage.setItem("vl_testMode",!0);var d=document.createElement("iframe");d.id="exit-test-mode",d.src=b.frameUrl+"exitTestModeWidget/exitTestModeWidget.min.html",d.style.cssText="-webkit-box-shadow: 0 14px 30px rgba(0, 0, 0, .12);box-shadow: 0 14px 30px rgba(0, 0, 0, .12);z-index: 16777271; margin-top: -100px; width:315px; height: 243px; position: fixed; top:50%; left: 0; background: white; border:0;",document.body.appendChild(d)}window.addEventListener("message",function(a){var b=document.getElementById("exit-test-mode");if("close_test_iframe"===a.data.type){localStorage.removeItem("vl_testMode"),b.parentNode.removeChild(b);for(var c=document.getElementsByClassName("vl-frame"),d=c.length-1;d>=0;--d){var f=c[d];f.parentNode.removeChild(f)}var g=window.location.search;return g=e("testMode","",g),void(window.location=window.location.pathname+g)}"maximize_test_iframe"===a.data.type?b.style.width="300px":"minimize_test_iframe"===a.data.type&&(b.style.width="38px")})}function e(a,b,c){var d=new RegExp("([?;&])"+a+"[^&;]*[;&]?"),e=c.replace(d,"$1").replace(/&$/,"");return(e.length>2?e+"&":"?")+(b?a+"="+b:"")}function f(a){var b=!1;return a&&a!=={}&&(a.email||a.referralCode||a.appUserId||a.facebookId)&&(b=!0),b}function g(){return{dt:h("dt")||"",firstname:h("firstname")||"",lastname:h("lastname")||"",email:h("email")||"",referralCode:h("userCode")||h("usercode")||"",createdAt:h("createdAt")||"",appUserId:h("appUserId")||"",facebookId:h("facebookId")||""}}function h(a,b){var c=b?b:window.location.href,d=new RegExp("[?&]"+a+"=([^&#]*)","i"),e=d.exec(c);return e?decodeURIComponent(e[1]):null}function i(){return b.afterLoad&&b.afterLoad.identify&&!b.identified&&!b.config.previewMode||h("autoDetect")&&!b.identified||h("userCode")&&!b.identified}function j(){return b.pendingEvents.length>0}function k(){return Object.keys(b.pendingIntegrations).find(function(a){return b.pendingIntegrations[a]===!0})}function l(a,b){!k()||a>2?b():setTimeout(function(){a++,l(a,b)},600)}function m(){var a;if(H&&"function"==typeof H){var b=H();return b&&"object"===("undefined"==typeof b?"undefined":d(b))&&!b.refSource&&(b.refSource=h("refSource")||h("refsource")||""),a=b,D.set("referrer",a),a}return D.get("referrer")?D.get("referrer"):(a={referralCode:h("referralCode")||h("referralcode")||"",refSource:h("refSource")||h("refsource")||""},a.referralCode&&D.set("referrer",a),a)}function n(){return{widgets:{name:"widgets",runStage:"any"},referralUrls:{name:"referralUrls",runStage:"postIdentify"},stats:{name:"stats",runStage:"postIdentify"},referralCount:{name:"referralCount",runStage:"postIdentify"},inquiry:{name:"inquiry",runStage:"postIdentify"},referrerInfo:{name:"referrerInfo",runStage:"any"},rewards:{name:"rewards",runStage:"any"},campaignInfo:{name:"campaignInfo",runStage:"any"},logs:{name:"logs",runStage:"postIdentify"},userData:{name:"userData",runStage:"postIdentify"},coupons:{name:"coupons",runStage:"postIdentify"}}}function o(){return function(a,c){if(D.get("user")){var e=D.get("user");b.user=e,b.config.identifier=e,b.identified=!0,b.identifiedFrom="cache",u(),b.pendingIntegrations.postIdentify=!0,v(b.user.needsDOI?"doi":"postIdentify"),l(0,function(){c&&"function"==typeof c&&(f(e)?setTimeout(function(){c(null,e)}):setTimeout(function(){c(b.makeError("Invalid user identifier"),{})}))})}else{if(a&&"object"===("undefined"==typeof a?"undefined":d(a))&&a.autoDetect&&(a=g(),0===Object.keys(a).filter(function(b){return a[b]}).length))return;var h=void 0;if(h=a.trackAction?"action":"registration",J&&"function"==typeof J)try{var i=J();i&&"object"===("undefined"==typeof i?"undefined":d(i))&&Object.keys(i).forEach(function(b){a[b]=i[b]})}catch(j){}B.postEvent(b,h,a,function(d,e){b.identified=!0,b.identifiedFrom="network",u(),a.isNew=e.isNew,d?c&&"function"==typeof c&&c(d):(a.referralCode=e.referralCode,a.cpk=e.page||!1,a=w(a,e),b.user=a,D.set("user",a),b.config.identifier=a,b.pendingIntegrations.postIdentify=!0,a.needsDOI?v("doi"):a.trackFormEvent&&q(a.acquiredFrom)?v("postIdentify",{updateWidgets:!1}):r()?(v("thanks"),D.clear()):v("postIdentify"),l(0,function(){a.guestCheckout&&t(a.email),
c&&"function"==typeof c&&c(null,e),C.hooks.runHook("formSubmit",{email:a.email,referralCode:a.referralCode,isNew:e.isNew}),!a.needsDOI&&a.trackFormEvent&&q(a.acquiredFrom)&&s(e.referralCode,a.acquiredFrom)}))})}}}function p(){return function(a,c){B.cacheReferrer(b,a,c)}}function q(a){switch(a){case"invitee_widget":return b.widgetData.widgets&&b.widgetData.widgets.inviteeForm&&"url"===b.widgetData.widgets.inviteeForm.participation.button.noReferrer.action;default:return b.widgetData.widgets&&b.widgetData.widgets.embedForm&&"url"===b.widgetData.widgets.embedForm.participation.button.noReferrer.action}}function r(){return 0==b.widgets.getByType("embedForm").length&&b.widgetData.widgets&&b.widgetData.widgets.inviteeForm&&"thanks"===b.widgetData.widgets.inviteeForm.participation.button.noReferrer.action}function s(a,c){var d,e=window.location.protocol+"//"+window.location.host+window.location.pathname;d="invitee_widget"===c?b.widgetData.widgets.inviteeForm.participation.button.noReferrer.url:b.widgetData.widgets.embedForm.participation.button.noReferrer.url,d.indexOf("?")>-1?d!==e+window.location.search&&(window.location.href=d+"&autoDetect=1&userCode="+a):d!==e?window.location.href=d+"?autoDetect=1&userCode="+a:v("postIdentify")}function t(a){window.vl_ajax&&window.vl_ajax.url&&window.jQuery?window.jQuery.post(window.vl_ajax.url,{email:a,action:"vl_guest_checkout"},function(c){b.get("coupons",function(c,d){c||(b.widgetData.coupons=d.coupons,D.removeGuestCheckoutCookie(a),b.widgets.getByType("rewardingWidget").forEach(function(b){G.updateState(b.widgetId,{coupons:d.coupons}),b.get("visible")||b.toggle(),d.coupons&&d.coupons.length>0?b.execute(function(a){this.goToTab("coupons")}):K<3&&setTimeout(function(){K++,t(a)},5e3)}))})}):(D.saveGuestCheckoutCookie(a),B.guestCheckoutSilentRefresh(function(c,d){c||b.get("coupons",function(c,d){c||(b.widgetData.coupons=d.coupons,D.removeGuestCheckoutCookie(a),b.widgets.getByType("rewardingWidget").forEach(function(b){G.updateState(b.widgetId,{coupons:d.coupons}),b.get("visible")||b.toggle(),d.coupons&&d.coupons.length>0?b.execute(function(a){this.goToTab("coupons")}):K<3&&setTimeout(function(){K++,t(a)},5e3)}))})}))}function u(){D.set("last_session_end",D.get("session_start")||0),D.set("session_start",Date.now())}function v(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{updateWidgets:!0};b.runStage=a,b.onStageChange&&"function"==typeof b.onStageChange&&b.onStageChange(b.runStage),C.hooks.runHook("stageChange",{stage:b.runStage}),y(),c&&c.updateWidgets===!0&&(G.widgetKeep.getAll().filter(function(a){return a.ready&&a.hideStage===b.runStage}).forEach(function(a){a.hide()}),b.config.autoLoadWidgets&&b.widgets.load())}function w(a,b){return b&&b.dt?(a.needsDOI=!0,a.dt=b.dt,b.email&&(a.email=b.email)):(a.needsDOI=!1,delete a.dt),a}function x(){G.widgetKeep.removeAll(),G.removeListeners(),C.hooks.resetHooks();var a=G.helpers.messageHandler.bind(G);G.setupListeners(a),G.createListenerDetacher(a),b.widgets.loading=!1}function y(){b.committedEvents=[];var a=!1;if(b.track=function(c,d){if(a)return void setTimeout(function(){b.track(c,d)},100);if(a=!0,E.indexOf(c)===-1){z(c,{commit:!1}),a=!1;var e=b.makeError("Invalid event "+c);return b.reportError(e),d&&"function"==typeof d?d(e):e}return b.committedEvents.indexOf(c)>-1?(a=!1,z(c,{commit:!1})):void B.postEvent(b,c,b.user,function(b,e){b?d&&"function"==typeof d&&d(b,{}):d&&"function"==typeof d&&d(null,e),z(c,{commit:!0}),a=!1})},b.pendingEvents&&b.pendingEvents.length>0){var c=b.pendingEvents.map(function(a){return a});c.forEach(function(a){b.track(a.event,a.cb)})}}function z(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{commit:!1},d=[],e=b.pendingEvents.length>0;b.pendingEvents.forEach(function(b,c){b.event===a&&d.push(c)}),d.forEach(function(a){b.pendingEvents.splice(a,1)}),c&&c.commit===!0&&b.committedEvents.push(a),e&&0===b.pendingEvents.length&&C.hooks.runHook("_pending_events_completed")}a("../polyfills");var A=a("./libs/widgetManager"),B=a("./libs/network"),C={network:a("./libs/network"),hooks:a("./libs/hooks")(b)};b.frameUrl="https://app.viral-loops.com/client/",b.apiUrl="https://app.viral-loops.com/api/",b.origin="https://app.viral-loops.com/",b.widgets=b.widgets||{},b.accessors=n(),b.activeAccessors=b.activeAccessors||[],b.pendingAccessors=b.pendingAccessors||[],b.pendingEvents=b.pendingEvents||[],b.pendingIntegrations=b.pendingIntegrations||{},b.paths=b.paths||[],b.widgetData=b.widgetData||{},b.runStage="preIdentify";var D,E=["conversion","action","order"],F=a("./libs/vlStore"),G=A.init(b,{previewMode:b.config.previewMode,network:C.network,hooks:C.hooks,origin:"https://app.viral-loops.com/"});G.exposeAction({action:"addHook",from:C.hooks,to:b}),C.hooks.registerPendingHooks(),a("./libs/behaviours")(b);var H,I=!1;b.setReferrer=function(a){H=a};var J,K=0;b.enrichUser=function(a){J=a},b.getSessionInfo=function(){var a=D.get("session_start"),b=D.get("last_session_end");return a&&b?{lastSessionEndedAt:parseInt(b),sessionStartedAt:parseInt(a)}:{lastSessionEndedAt:0,sessionStartedAt:Date.now()}},b.onWidgetUpdate=b.onWidgetUpdate||function(a,b){},b.onWidgetLoad=b.onWidgetLoad||function(a){},b.onWidgetsLoad=b.onWidgetsLoad||function(a){},b.onStageChange=b.onStageChange||function(a){},b.onBoot=b.onBoot||function(){},b.get=function(a,c){if(a&&"string"==typeof a)G.getDataOnDemand([a],function(a,b){if(c&&"function"==typeof c)return c(a,b)});else if(a&&a.length)G.getDataOnDemand(a,function(a,b){if(c&&"function"==typeof c)return c(a,b)});else{var d=b.makeError("Invalid value "+a);if(b.reportError(d),c&&"function"==typeof c)return c(d)}};var L=!1;return b.widgets.load=function(){if(i()||j())i()?b.addHook("stageChange",function(a){"postIdentify"===a.stage&&b.widgets.load()}).async():j()&&b.addHook("_pending_events_completed",function(a){b.widgets.load()}).async();else{if(b.widgets.loading&&!I)return;L||(b.widgets.loading=!0,b.addHook("widgetsLoad",function(){b.widgets.loading=!1}),b.addHook("widgetUpdate",function(){b.widgets.loading=!1}),L=!0),0!==G.widgetKeep.widgetCount()||I?G.widgetKeep.getWidgetsWithInactiveFrame().length>0&&(G.widgetKeep.removeAll(),b.widgets.loading=!1,b.widgets.load()):G.preload();var a,c=h("dt");c&&(a=!0,b.config.identifier=b.config.identifier||{},b.config.identifier.dt=c),G.getData(function(a,c){if(c&&c.userData){var d=w(c.userData,c.doi);b.user=d,D.set("user",d),b.config.identifier=d,d.needsDOI?v("doi"):!d.needsDOI&&c.campaignInfo&&c.campaignInfo.doi&&c.campaignInfo.doi.enabled&&("all"==c.campaignInfo.doi.enabled||"referred"==c.campaignInfo.doi.enabled||"true"==c.campaignInfo.doi.enabled||1==c.campaignInfo.doi.enabled)&&(b.widgets.loading=!0,v("postIdentify"))}G.widgetKeep.getAll().filter(function(a){return a.runStage===b.runStage||"any"===a.runStage||b.config.previewMode}).forEach(function(b){b.show({withEmptyState:Boolean(a)})})},a)}},b.widgets.reload=function(){b.widgets.loading?b.addHook("widgetsLoad",function(){b.widgets.reload()}):(x(),b.widgets.load())},b.logout=function(a){this.user={},this.referrer={},this.config.identifier={},D.clear(),this.runStage="preIdentify",this.committedEvents=[],this.pendingEvents=[],this.pendingIntegrations={},this.activeAccessors=[],this.pendingAccessors=[],this.widgetData={},this.identified=!1,a&&a.reloadWidgets?b.widgets.reload():x(),a&&a.callback&&"function"==typeof a.callback&&a.callback()},b.widgets.create=function(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments[2];if(["sharingWidget","rewardStats","welcomeBar","rewardingWidget","rewardingWidgetTrigger","embedForm","inviteeForm","notificationBubble","takeOverWidget","milestoneWidget","referralCountWidget","ambassadorWidget"].indexOf(a)===-1)return b.reportError(b.makeError("Invalid widget: "+a));if(!document.querySelector(c.container))return b.reportError(b.makeError("Invalid widget container: "+c.container));I=!0;var e={type:a,element:document.querySelector(c.container),options:{position:c.position||null,embed:c.embed||!1,widgetId:c.widgetId||null}},f=G.helpers.build(b.publicToken,[e],{frameUrl:b.frameUrl})[0];G.registerWidgets([f]);var g=G.widgetKeep.getById(f.widgetId);G.helpers.addToDom(f,function(a){g.add("frame",a),C.hooks.runHook("_frame_available",{widgetId:g.get("widgetId")}),d&&"function"==typeof d&&d(g)},function(a){g&&g.get("available")===!1&&b.reportError(b.makeError("widget failed to load"))});var h=document.createElement("div");h.dataset.vlWidget=a,h.dataset.vlWidgetPosition=e.options.position,h.dataset.vlWidgetEmbed=e.options.embed,e.element.appendChild(h)},b.makeError=function(a){var b=new Error;return b.message=a,b},b.reportError=function(a){throw a},c(),b}},{"../polyfills":6,"./libs/behaviours":7,"./libs/hooks":8,"./libs/network":9,"./libs/vlStore":10,"./libs/widgetManager":11}]},{},[18])}();